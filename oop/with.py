class DefenedVector:
    # Определение класса DefenedVector, который будет использоваться как контекстный менеджер
    def __init__(self, value):
        self.__value = value

    def __enter__(self):
        # Метод вызывается при входе в блок with
        # Создаём копию исходного списка, чтобы при необходимости откатить изменения
        self.__temp = self.__value[:]
        # Возвращаем копию списка, которая будет доступна в блоке with под именем dv
        return self.__temp

    def __exit__(self, type, value, traceback):
        # Метод вызывается при выходе из блока with
        # type — тип исключения (если возникло), value — объект исключения, traceback — трассировка стека
        if type is None:
            # Если исключение не произошло (type == None), применяем изменения
            self.__value[:] = self.__temp
            # Копируем временные данные обратно в оригинальный список
        # Возвращаем False, чтобы исключение (если есть) не подавлялось
        return False


v1 = [1, 2, 3]
v2 = [4, 5]

try:
    """
    with — это синтаксический сахар для безопасной работы с ресурсами (например, файлами, 
    соединениями, транзакциями). Он гарантирует, что при любом исходе (даже если 
    произойдёт исключение), всегда выполнится "очистка". Любой объект, у которого есть 
    методы __enter__ и __exit__, можно использовать с with.
    
    Как работает with:
    1. __enter__ — вызывается при входе в блок with.
    2. Результат __enter__ — то, что попадает в переменную после as.
    3. Код в блоке with выполняется.
    4. __exit__ — вызывается при выходе из блока, даже если произошло исключение.
    5. В __exit__ можно решить, подавлять исключение или нет (возвращая True или False).
    """
    with DefenedVector(v1) as dv:
        # При входе в with вызывается __enter__, возвращающий копию v1
        # dv — это временная копия v1, с которой можно безопасно работать
        for i, val in enumerate(dv):
            dv[i] += v2[i]
            # Изменяем копию: добавляем соответствующие элементы из v2
            # Если длина v2 меньше v1, произойдёт IndexError, и сработает __exit__
except:
    print("Error")
    # Если произошло исключение (например, IndexError), выводим сообщение

print(v1)
# После выхода из with, если было исключение, v1 остаётся без изменений
# Если ошибки не было, v1 обновляется значениями из dv